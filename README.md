# 银行客户认购产品预测

## 演示demo
http://182.92.163.3:8010/

## 训练过程

1. **数据准备和预处理**:
    - 加载训练数据 (`train.csv`)。
    - 对目标变量 (`subscribe`) 和二元特征 (`default`, `housing`) 进行数值编码。
    - 处理周期性特征 (`month`, `day_of_week`)，转换为正弦和余弦特征。
    - 处理 `pdays` 特征，创建 `contacted_before` 特征。

2. **定义特征类型**:
    -  指定数值型特征 (`numerical_cols`) 和类别型特征 (`categorical_cols`)。

3. **训练初始模型**:
    - 构建预处理管道 (`ColumnTransformer`)，对数值特征标准化，类别特征独热编码。
    - 训练三种模型:
        - 随机森林 (RandomForestClassifier)，使用网格搜索优化参数。
        - Bagging 随机森林 (BalancedRandomForestClassifier)，专门处理不平衡数据。
        - XGBoost (XGBClassifier)，同样考虑数据不平衡。

4. **特征选择**:
    - 使用随机森林模型的特征重要性。
    - 可视化特征重要性。
    - 基于重要性阈值自动选择重要特征。

5. **训练优化模型**:
    - 基于选择的特征，构建新的预处理管道 (仅处理选择的特征)。
    - 使用优化后的预处理管道和随机森林算法训练优化模型。

6. **模型评估**:
    - 在测试集上评估完整模型和优化模型的准确率。

7. **模型存储**:
    - 保存完整随机森林模型、XGBoost 模型、优化模型以及特征元数据到 `model/` 目录，以便后续使用。

## 模型部署

1. **加载模型与元数据**:  读取预训练模型和特征信息。
2. **创建 Flask 应用**:  搭建 Web 服务框架。
3. **定义路由**:  设置网页访问路径 (`/` 首页, `/predict` 预测接口)。
4. **接收用户输入**:  获取网页表单提交的数据。
5. **数据预处理**:  转换数据类型，进行特征工程 (如周期性特征)。
6. **特征验证与选择**:  检查输入特征，选择模型所需特征。
7. **模型预测**:  使用加载的模型进行预测。
8. **展示结果**:  渲染网页模板，展示预测结果和概率。
9. **错误处理**:  处理预测过程可能出现的错误，返回错误页面。
10. **启动服务**:  docker部署，运行 Flask 应用，对外提供预测服务。

# 题目描述

## 赛题背景

本赛题以银行产品认购预测为背景，旨在预测客户是否会购买银行的产品。在与客户沟通的过程中，我们记录了以下信息：

- **客户沟通数据**：联系次数、上一次联系的时长、上一次联系的时间间隔等。
- **客户基本信息**：年龄、职业、婚姻状况、是否有违约记录、是否有房贷等。
- **市场环境数据**：就业情况、消费信息、银行同业拆借率等。

---

## 赛题任务

**To DO**：预测用户是否会购买银行产品。

---

## 数据字段说明

| 字段 | 说明 |
| --- | --- |
| `age` | 年龄 |
| `job` | 职业：admin, unknown, unemployed, management… |
| `marital` | 婚姻状况：married, divorced, single |
| `default` | 信用卡是否有违约：yes or no |
| `housing` | 是否有房贷：yes or no |
| `contact` | 联系方式：unknown, telephone, cellular |
| `month` | 上一次联系的月份：jan, feb, mar, … |
| `day_of_week` | 上一次联系的星期几：mon, tue, wed, thu, fri |
| `duration` | 上一次联系的时长（秒） |
| `campaign` | 活动期间联系客户的次数 |
| `pdays` | 上一次与客户联系后的间隔天数 |
| `previous` | 在本次营销活动前，与客户联系的次数 |
| `poutcome` | 之前营销活动的结果：unknown, other, failure, success |
| `emp_var_rate` | 就业变动率（季度指标） |
| `cons_price_index` | 消费者价格指数（月度指标） |
| `cons_conf_index` | 消费者信心指数（月度指标） |
| `lending_rate3m` | 银行同业拆借率 3个月利率（每日指标） |
| `nr_employed` | 雇员人数（季度指标） |
| `subscribe` | 客户是否购买：yes 或 no |

---

# 评价标准

**Accuracy（准确率）**：所有分类正确的百分比。